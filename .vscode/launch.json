// A launch configuration that compiles the extension and then opens it inside a new window
// Use IntelliSense to learn about possible attributes.
// Hover to view descriptions of existing attributes.
// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387

// What was previously ${workspaceFolder} when this was a standalong project
// is e.g. ${workspaceFolder}/packages/vscode-ext now that this is a monorepo.
{
  "version": "0.2.0",
  "configurations": [
    // This configuration is for the VS Code extension
    // It launches a new VS Code instance with the extension loaded
    {
      "name": "Run Extension",
      "type": "extensionHost",
      "request": "launch",
      "args": ["--extensionDevelopmentPath=${workspaceFolder}/packages/vscode-ext"],
      "outFiles": ["${workspaceFolder}/packages/vscode-ext/dist/**/*.js"],
      "preLaunchTask": "vscode-ext: watch",
      "sourceMapPathOverrides": {
        "webpack://sys-view/*": "${workspaceFolder}/packages/vscode-ext/*"
      }
    },
    // This configuration is for debugging the test suite of the extension
    // It launches a new VS Code instance with the extension loaded and the test runner configured to run the tests once the window opens
    // See https://code.visualstudio.com/api/working-with-extensions/testing-extension#running-extension-tests for more information
    // Note that the test runner will wait for 10 seconds for the debugger to attach before running the tests, to give you time to set breakpoints
    // You can change this timeout with the "timeout" attribute.
    // The test runner will run all tests in the file specified by --extensionTestsPath
    // so you can change that to point to a different test file if needed
    // The test runner will automatically exit once the tests are done so you don't need to do anything special to stop debugging.
    // If you want to debug the tests in a different way, you can also run the tests from the command line, see the "scripts" section in package.json.
    // and then attach to the running extension host using the "Extension Tests (Attach)" configuration
    // below
    {
      "name": "Extension Tests",
      "type": "extensionHost",
      "request": "launch",
      "args": [
        "--extensionDevelopmentPath=${workspaceFolder}/packages/vscode-ext",
        "--extensionTestsPath=${workspaceFolder}/packages/vscode-ext/dist/test"
      ],
      "outFiles": ["${workspaceFolder}/packages/vscode-ext/dist/**/*.js"],
      "preLaunchTask": "vscode-ext: watch"
    },
    // These configurations are for the Electron app
    {
      "name": "Electron Main",
      "type": "node",
      "request": "launch",
      "runtimeExecutable": "${workspaceFolder}/node_modules/@electron-forge/cli/script/vscode.sh",
      "windows": {
        "runtimeExecutable": "${workspaceFolder}/node_modules/@electron-forge/cli/script/vscode.cmd"
      },
      // runtimeArgs will be passed directly to your Electron application
      "runtimeArgs": ["--remote-debugging-port=9222"],
      "cwd": "${workspaceFolder}/packages/electron-app",
      "console": "integratedTerminal",
      "sourceMapPathOverrides": {
        "webpack://apis/*": "${workspaceFolder}/packages/electron-app/*"
      }
    },
    {
      "name": "Electron Renderer",
      "type": "chrome",
      "request": "attach",
      "port": 9222,
      "timeout": 120000,
      "sourceMapPathOverrides": {
        "webpack://apis/*": "${workspaceFolder}/packages/electron-app/*"
      }
    },
    // This was the unit-tests of the Electron app,
    // not currently supported
    // and not yet converted to monorepo paths
    {
      "name": "Electron Unit Tests",
      "type": "node",
      "request": "launch",
      "runtimeExecutable": "npm",
      "runtimeArgs": ["run-script", "unit-test-1"],
      "skipFiles": ["<node_internals>/**"]
    }
  ],
  "compounds": [
    {
      "name": "Electron All",
      "configurations": ["Electron Main", "Electron Renderer"]
    }
  ]
}
